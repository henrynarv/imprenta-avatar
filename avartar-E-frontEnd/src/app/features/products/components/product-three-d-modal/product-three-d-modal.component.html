<!-- 3D Modal -->
@if (isViewerOpen() && activeProduct()) {
<div
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 animate-fade-in"
>
  <div
    class="bg-white rounded-xl shadow-xl w-full max-w-6xl h-[80vh] flex flex-col animate-scale-in"
  >
    <!-- Header -->
    <div class="flex-shrink-0 border-b border-gray-200 bg-white p-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <ng-icon name="heroCube" class="text-blue-600" size="24"></ng-icon>
          <div>
            <h2 class="text-xl font-semibold text-gray-900">
              {{ activeProduct()?.name }} - Vista 3D
            </h2>
            <p class="text-gray-600">Interactúa con el modelo 3D</p>
          </div>
        </div>

        <button
          (click)="closeModal()"
          class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
        >
          <ng-icon name="heroXMark" size="20"></ng-icon>
        </button>
      </div>
    </div>

    <!-- Contenido -->
    <div class="flex-1 flex flex-col md:flex-row overflow-hidden">
      <!-- Visor 3D -->
      <div class="flex-1 p-6 bg-gray-50">
        <!-- <app-product-3d-viewer
          [product]="activeProduct()!"
        ></app-product-3d-viewer> -->
        <app-product-3d-viewer
          [modelUrl]="activeProduct()!.model3D!.gltfUrl"
          [defaultColor]="activeProduct()!.model3D!.defaultColor"
          [colorableParts]="activeProduct()!.model3D!.colorableParts"
          [product]="activeProduct()"
          class="w-full h-full"
        ></app-product-3d-viewer>
      </div>

      <!-- Panel de Control -->
      <div class="w-full md:w-80 bg-white border-l border-gray-200 p-6">
        <h3 class="text-lg font-semibold mb-4">Personalizar Color</h3>

        <div class="space-y-4">
          <div class="space-y-1">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Color del producto
            </label>
            <input
              type="color"
              [value]="selectedColor()"
              (input)="onColorChange($event)"
              class="w-20 h-20 rounded-lg border border-gray-300 cursor-pointer"
            />
            <p class="text-sm text-gray-600 mt-2">{{ selectedColor() }}</p>

            <button
              (click)="resetColor()"
              class="flex items-center space-x-1 text-xs text-gray-500 hover:text-blue-400 transition-colors"
            >
              <ng-icon name="heroArrowPath" size="12"></ng-icon>
              <span>Restablecer</span>
            </button>
          </div>

          <div class="pt-4 border-t border-gray-200">
            <h4 class="font-medium text-gray-700 mb-2">Controles</h4>
            <ul class="text-sm text-gray-600 space-y-1">
              <li class="flex items-center space-x-2">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  width="24"
                  height="24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="text-gray-400 w-3.5 h-3.5"
                >
                  <path d="M21 12a9 9 0 1 1-3.5-7.1" />
                  <polyline points="21 3 21 9 15 9" />
                </svg>
                <span>Click y arrastra para rotar</span>
              </li>
              <li class="flex items-center space-x-2">
                <ng-icon
                  name="heroMagnifyingGlassPlus"
                  size="16"
                  class="text-gray-400"
                ></ng-icon>
                <span>Rueda del mouse para zoom</span>
              </li>
              <li class="flex items-center space-x-2">
                <ng-icon
                  name="heroCube"
                  size="16"
                  class="text-gray-400"
                ></ng-icon>
                <span>Click derecho para mover</span>
              </li>
            </ul>
          </div>

          @if (activeProduct()?.model3D) {
          <div class="pt-4 border-t border-gray-200">
            <h4 class="font-medium text-gray-700 mb3">
              Información del modelo
            </h4>
            <div class="space-y-2 text-sm text-gray-600">
              <div class="flex justify-between">
                <span>Formato:</span>
                <span class="font-medium uppercase">{{
                  activeProduct()?.model3D?.format
                }}</span>
              </div>
              @if (activeProduct()?.model3D?.fileSize) {
              <div class="flex justify-between">
                <span>Tamaño:</span>
                <span class="font-medium">
                  {{
                    (
                      (activeProduct()?.model3D?.fileSize ?? 0) /
                      (1024 * 1024)
                    ).toFixed(1)
                  }}
                  MB
                </span>
              </div>
              }
            </div>
          </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>
}
