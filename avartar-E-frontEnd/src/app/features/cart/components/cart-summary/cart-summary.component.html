<!-- Resumen del carrito - Sidebar sticky -->
<div class="bg-white rounded-xl shadow-lg border border-gray-200 sticky top-8">
  <!-- Header del resumen -->
  <div class="px-6 py-4 border-b border-gray-200 bg-gray-50 rounded-t-xl">
    <h2 class="text-xl font-bold text-gray-900">Resumen del Pedido</h2>
  </div>

  <!-- Contenido del resumen -->
  <div class="p-6 space-y-6">
    <!-- Opciones de envío -->
    <div class="space-y-3">
      <label class="block text-sm font-medium text-gray-700">
        Método de Envío
      </label>

      <select
        (change)="onShippingChange($event)"
        [value]="selectedShipping()?.id || ''"
        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
      >
        <option value="">Selecciona envío</option>
        @for (option of cartService.shippingOptions; track option.id) {
        <option [value]="option.id">
          {{ option.name }} -
          {{
            option.price === 0
              ? "Gratis"
              : (option.price | currency : "CLP" : "symbol" : "1.0-0")
          }}
        </option>
        }
      </select>

      <!-- Badge de envío gratis -->
      @if (freeShippingText() && !isShippingFree()) {
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
        <p class="text-sm text-blue-800 font-medium flex items-center">
          <ng-icon name="heroTruck" size="16" class="inline mr-1"></ng-icon>
          {{ freeShippingText() }}
        </p>
      </div>
      } @if (isShippingFree()) {
      <div class="bg-green-50 border border-green-200 rounded-lg p-3">
        <p class="text-sm text-green-800 font-medium">
          <ng-icon name="heroTruck" size="16" class="inline mr-1"></ng-icon>
          {{ freeShippingText() }}
        </p>
      </div>
      }
    </div>

    <!-- Desglose de precios -->
    <div class="space-y-3">
      <div class="flex justify-between text-sm">
        <span class="text-gray-600">Subtotal</span>
        <span class="text-gray-900 font-medium">
          {{ summary().subtotal | currency : "CLP" : "symbol" : "1.0-0" }}
        </span>
      </div>

      <!-- Envío -->
      <div class="flex justify-between text-sm">
        <span class="text-gray-600">Envío</span>
        <span
          [class]="
            isShippingFree()
              ? 'text-green-600 font-medium'
              : 'text-gray-900 font-medium'
          "
        >
          {{
            isShippingFree()
              ? "Gratis"
              : (summary().shipping | currency : "CLP" : "symbol" : "1.0-0")
          }}
        </span>
      </div>

      <!-- Impuestos -->
      <div class="flex justify-between text-sm">
        <span class="text-gray-600">IVA (19%)</span>
        <span class="text-gray-900 font-medium">
          {{ summary().tax | currency : "CLP" : "symbol" : "1.0-0" }}
        </span>
      </div>

      <!-- Descuentos -->
      @if (summary().discount > 0) {
      <div class="flex justify-between text-sm">
        <span class="text-gray-600">Descuento</span>
        <span class="text-green-600 font-medium">
          -{{ summary().discount | currency : "CLP" : "symbol" : "1.0-0" }}
        </span>
      </div>
      }

      <!-- Línea divisoria -->
      <div class="border-t border-gray-200 pt-3">
        <div class="flex justify-between text-lg font-bold">
          <span class="text-gray-900">Total</span>
          <span class="text-gray-900">
            {{ summary().total | currency : "CLP" : "symbol" : "1.0-0" }}
          </span>
        </div>
      </div>
    </div>

    <!-- Información de garantía -->
    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
      <div class="flex items-start space-x-3">
        <ng-icon
          name="heroShieldCheck"
          class="text-green-600 mt-0.5"
          size="20"
        ></ng-icon>
        <div>
          <p class="text-sm font-medium text-gray-900">Garantía de calidad</p>
          <p class="text-xs text-gray-600 mt-1">
            Todos nuestros productos incluyen garantía de satisfacción y calidad
            premium.
          </p>
        </div>
      </div>
    </div>

    <!-- Botones de acción -->
    <div class="space-y-3">
      <!-- Botón checkout -->
      <button
        (click)="proceedToCheckout()"
        [disabled]="!canCheckout() || isLoading()"
        [class]="
          'w-full flex items-center justify-center space-x-2 px-6 py-4 rounded-xl font-semibold text-white transition-all duration-200 transform ' +
          (canCheckout()
            ? 'bg-blue-600 hover:bg-blue-700 hover:scale-105 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2'
            : 'bg-gray-400 cursor-not-allowed')
        "
      >
        @if (isLoading()) {
        <div
          class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"
        ></div>
        <span>Procesando...</span>
        } @else {
        <span>Proceder al Pago</span>
        <ng-icon name="heroArrowRight" size="20"></ng-icon>
        }
      </button>

      <!-- Botón continuar comprando -->
      <button
        (click)="continueShopping()"
        class="w-full px-6 py-3 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors duration-200"
      >
        Continuar Comprando
      </button>
    </div>
  </div>
</div>
