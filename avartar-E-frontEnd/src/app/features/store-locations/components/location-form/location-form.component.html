<div
  class="bg-white rounded-2xl shadow-xl border border-gray-200 animate-slide-in"
>
  <!-- header del formulario -->
  <div class="bg-gradient-to-r from-blue-600 to-blue-700 p-6 rounded-t-2xl">
    <div class="flex items-center justify-between">
      <div class="flex items-center justify-center">
        <div class="bg-white/20 p-3 rounded-2xl backdrop-blur-sm mr-4">
          <div
            class="bg-white p-2 w-12 h-12 flex items-center justify-center rounded-full"
          >
            <ng-icon
              [name]="isEditing() ? 'heroBuildingStorefront' : 'heroPlus'"
              size="24"
              class="text-blue-600"
            ></ng-icon>
          </div>
        </div>

        <div>
          <h2 class="text-2xl font-bold text-white">{{ formTitle() }}</h2>
          <p class="text-blue-100 text-sm">
            {{
              isEditing()
                ? "Actualiza la información de la sede"
                : "Completa la información para crear una nueva sede"
            }}
          </p>
        </div>
      </div>

      <button
        (click)="onCancel()"
        [disabled]="isLoading()"
        class="text-white hover:text-gray-100 p-2 rounded-lg transition-colors disabled:opacity-50"
        title="Cancelar"
      >
        <ng-icon name="heroXMark" size="24"></ng-icon>
      </button>
    </div>
  </div>
  <!-- Formulario -->
  <div class="p-6">
    <form [formGroup]="locationForm" (ngSubmit)="onSubmit()" class="space-y-6">
      <!-- Información Básica -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Mombre -->
        <div>
          <label
            for="name"
            class="block text-sm font-medium text-gray-700 mb-2"
          >
            Nombre de la Sede *
          </label>
          <div class="relative">
            <div
              class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-auto"
            >
              <ng-icon
                name="heroBuildingStorefront"
                size="20"
                class="text-gray-400"
              ></ng-icon>
            </div>
            <input
              id="name"
              type="text"
              formControlName="name"
              [class]="getFieldClasses('name')"
              placeholder="Ej: Sede Central Providencia"
              class="pl-10 pr-4"
              autocomplete="off"
            />
          </div>

          @if(hasError('name')) {
          <p class="mt-1 text-sm text-red-600 animate-fade-in">
            {{ getErrorMessage("name") }}
          </p>
          }
        </div>

        <!-- Telefono -->
        <div>
          <label
            for="phone"
            class="block text-sm font-medium text-gray-700 mb-2"
            >Teléfono *</label
          >
          <div class="relative">
            <div
              class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
            >
              <ng-icon
                name="heroPhone"
                size="20"
                class="text-gray-400"
              ></ng-icon>
            </div>
            <input
              id="phone"
              type="tel"
              formControlName="phone"
              [class]="getFieldClasses('phone')"
              class="pl-10 pr-4"
              placeholder="Ej: +56 9 1234 5678"
              autocomplete="tel"
            />
          </div>
          @if (hasError('phone')) {
          <p class="mt-1 text-sm text-red-600 animate-fade-in">
            {{ getErrorMessage("phone") }}
          </p>
          }
        </div>
      </div>

      <!-- Dirección -->
      <div>
        <label
          for="address"
          class="block text-sm font-medium text-gray-700 mb-2"
        >
          Dirección Completa *
        </label>
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <ng-icon
              name="heroMapPin"
              size="20"
              class="text-gray-400"
            ></ng-icon>
          </div>
          <input
            id="address"
            type="text"
            formControlName="address"
            [class]="getFieldClasses('address')"
            class="pl-10 pr-4"
            placeholder="Ej: Av. Providencia 123, Providencia, Santiago"
            autocomplete="street-address"
          />
        </div>
        @if (hasError('address')) {
        <p class="mt-1 text-sm text-red-600 animate-fade-in">
          {{ getErrorMessage("address") }}
        </p>
        }
      </div>

      <!-- Horario -->
      <div>
        <label for="hours" class="block text-sm font-medium text-gray-700 mb-2">
          Horario de Atención *
        </label>
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <ng-icon name="heroClock" size="20" class="text-gray-400"></ng-icon>
          </div>
          <input
            id="hours"
            type="text"
            formControlName="hours"
            [class]="getFieldClasses('hours')"
            class="pl-10 pr-4"
            placeholder="Ej: Lunes a Viernes de 8:00 a 18:00 Sáb de 8:00 a 14:00"
            autocomplete="off"
          />
        </div>
        @if (hasError('hours')) {
        <p class="mt-1 text-sm text-red-600 animate-fade-in">
          {{ getErrorMessage("hours") }}
        </p>
        }
      </div>

      <!-- Mapa para Selección de Ubicación -->
      <div>
        <div class="flex items-center justify-between mb-4">
          <label class="block text-sm font-medium text-gray-700">
            Selecciona la Ubicación en el mapa *
          </label>
          <button
            type="button"
            (click)="useCurrentLocation()"
            [disabled]="isLoading()"
            class="text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center transition-colors disabled:opacity-50"
          >
            <ng-icon name="heroMapPin" size="16" class="mr-1"></ng-icon>
            Usar mi ubicación
          </button>
        </div>

        <!-- Mapa de Selección -->
        <div class="border border-gray-300 rounded-lg overflow-hidden h-64">
          <google-map
            #map
            [mapId]="mapId()"
            height="100%"
            width="100%"
            [center]="mapCenter()"
            [zoom]="15"
            (mapClick)="onMapClick($event)"
            #googleMap
          >
            <!-- Marcador de posición seleccionada -->
            @if (selectedPosition()) {
            <map-advanced-marker
              [position]="selectedPosition()!"
              title="Ubicación Seleccionada"
            >
              <div
                class="bg-blue-600 text-white px-3 py-2 rounded-full font-semibold text-sm border-white shadow-lg"
              >
                <ng-icon name="heroMapPin" size="16"></ng-icon>
              </div>
            </map-advanced-marker>
            }
          </google-map>
        </div>

        <!-- Coordenadas Seleccionadas -->
        @if (selectedPosition()) {
        <div class="mt-3 p-3 bg-green-50 border border-green-200 rounded-lg">
          <p class="text-sm text-green-800 flex items-center">
            <ng-icon name="heroCheck" sisze="16" class="mr-2"></ng-icon>
            Ubicación Seleccionada:
            <span class="font-mono ml-1">
              {{ selectedPosition()!.lat | number : "1.5-5" }},
              {{ selectedPosition()!.lng | number : "1.5-5" }}
            </span>
          </p>
        </div>
        }@else {
        <div class="mt-3 bg-yellow-50 border border-yellow-200 rounded-lg">
          <p class="text-sm text-yellow-800 flex items-center">
            <ng-icon name="heroMapPin" size="16" class="mr-2"></ng-icon>
            Haz clic en el mapa para selelcinar la ubicación
          </p>
        </div>
        }
      </div>

      <!-- Campos Ocultos para coordenadas -->
      <div class="hidden">
        <input type="number" formControlName="latitude" />
        <input type="number" formControlName="longitude" />
      </div>

      <!-- Botones de Acción -->
      <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
        <button
          type="button"
          (click)="onCancel()"
          [disabled]="isLoading()"
          class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors disabled:opacity-50 font-medium"
        >
          Cancelar
        </button>

        <button
          type="submit"
          [disabled]="!canSubmit()"
          [class]="
            canSubmit()
              ? 'bg-blue-600 hover:bg-blue-700 transform hover:scale-105'
              : 'bg-gray-400 cursor-not-allowed'
          "
          class="px-6 py-3 text-white rounded-lg transition-all duration-200 font-medium flex items-center"
        >
          @if (isLoading()) {
          <svg
            class="animate-spin -ml-1 mr-3 h-5 w-5 text-white"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
          }@else {
          <ng-icon
            [name]="isEditing() ? 'heroCheck' : 'heroPlus'"
            size="18"
            class="mr-2"
          ></ng-icon>
          }
          {{ submitButtonText() }}
        </button>
      </div>
    </form>
  </div>
</div>
